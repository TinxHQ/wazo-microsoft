paths:
  /backends/office365/sources:
    get:
      operationId: list_microsoft_source
      summary: Get microsoft configuration
      description: '**Required ACL:** `dird.backends.microsoft.sources.read`'
      tags:
        - configuration
      responses:
        '200':
          description: Configured microsoft source
          schema:
            $ref: '#/definitions/MicrosoftSourceItems'
    post:
      operationId: create_microsoft_source
      summary: Configure a source for the microsoft backend
      description: '**Required ACL:** `dird.backends.microsoft.sources.create`'
      tags:
        - configuration
      parameters:
        - in: body
          name: body
          description: The display configuration body
          required: true
          schema:
            $ref: '#/definitions/MicrosoftSourcePost'
      responses:
        '201':
          description: The created display
          schema:
            $ref: '#/definitions/MicrosoftSource'
          examples:
            application/json:
              first_matched_columns: []
              searched_columns: []
              format_columns:
                name: "{firstname} {lastname}"
                display_name: "{firstname} {lastname}"
                phone_mobile: "{mobile}"
                reverse: "{firstname} {lastname}"
              name: office365
              tenant_uuid: 518bdf22-fb53-46c7-9639-0ebd3e95d09c
              uuid: 5a3ba880-4c8c-4bde-8383-4e8dab9a19cf
              office365: office365
        '400':
          $ref: '#/responses/CreateError'
        '409':
          description: Source already exists
          schema:
            $ref: '#/definitions/Error'
  /backends/office365/sources/{source_uuid}:
    get:
      operationId: get_a_microsoft_source
      summary: Get a `microsoft` source configuration
      description: '**Required ACL:** `dird.backends.microsoft.sources.{source_uuid}.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
      responses:
        '200':
          description: The `microsoft` source
          schema:
            $ref: '#/definitions/MicrosoftSource'
        '404':
          $ref: '#/responses/NotFoundError'
    put:
      operationId: update_microsoft_source
      summary: Update a `microsoft` source configuration
      description: '**Required ACL:** `dird.backends.microsoft.sources.{source_uuid}.update`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
        - name: body
          in: body
          description: The source configuration body
          required: true
          schema:
            $ref: '#/definitions/MicrosoftSource'
      responses:
        '204':
          $ref: '#/responses/ResourceUpdated'
        '400':
          $ref: '#/responses/UpdateError'
        '404':
          $ref: '#/responses/NotFoundError'
        '409':
          description: Duplicate Source
          schema:
            $ref: '#/definitions/Error'
    delete:
      operationId: delete_microsoft_source
      summary: Delete a `microsoft` source configuration
      description: '**Required ACL:** `dird.backends.microsoft.sources.{source_uuid}.delete`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
      responses:
        '204':
          $ref: '#/responses/ResourceDeleted'
        '404':
          $ref: '#/responses/NotFoundError'
definitions:
  MicrosoftSource:
    title: MicrosoftSource
    allOf:
      - properties:
          auth:
            $ref: '#/definitions/WazoAuthConfig'
          confd:
            $ref: '#/definitions/ConfdConfig'
      - required:
        - name
        - auth
        - confd
  MicrosoftSourcePost:
    type: object
    properties:
      auth:
        $ref: '#/definitions/MicrosoftSourcePostAuth'
      endpoint:
        description: Endpoint where to get the information from
        example: "https://graph.microsoft.com/v1.0/me/contacts"
        default: "https://graph.microsoft.com/v1.0/me/contacts"
        type: string
      format_columns:
        $ref: '#/definitions/MicrosoftSourcePostFormatColumns'
      name:
        description: Source name
        type: string
        example: office365
      type:
        description: Source type
        example: office365
        type: string
    required:
      - auth
      - format_columns
      - name
      - type
  MicrosoftSourcePostAuth:
    title: auth
    properties:
      host:
        description: Where to find wazo-auth service
        example: localhost
        type: string
      port:
        description: Port on which wazo-auth is exposed
        default: 9497
        type: string
      verify_certificate:
        default: true
        example: false
        type: string
    required:
      - host
  MicrosoftSourcePostFormatColumns:
    title: format_columns
    properties:
      name:
        example: "{firstname} {lastname}"
        type: string
      display_name:
        example: "{firstname} {lastname}"
        type: string
      phone:
        example: "{phone}"
        type: string
      phone_mobile:
        example: "{mobile}"
        type: string
      reverse:
        example: "{firstname} {lastname}"
        type: string
    required:
      - name
      - display_name
      - phone_mobile
      - reverse
  MicrosoftSourceItems:
    title: MicrosoftSourceItems
    allOf:
      - $ref: '#/definitions/SourceItems'
      - properties:
          items:
            type: array
            items:
              $ref: '#/definitions/MicrosoftSource'
            readOnly: true
      - required:
        - items
        - total
        - filtered
  ConfdConfig:
    title: Confd
    allOf:
      - $ref: '#/definitions/ExternalServiceConfig'
      - properties:
          port:
            type: integer
            default: 9486
          https:
            type: boolean
            default: true
          version:
            type: string
            default: "1.1"
  WazoAuthConfig:
    title: Auth
    allOf:
      - $ref: '#/definitions/ExternalServiceConfig'
      - properties:
          port:
            type: integer
            default: 9497
          key_file:
            type: string
            description: The path the the file containing the credentials
          username:
            type: string
            description: The username to use when not using a key_file
          password:
            type: string
            description: The password to use when not using a key_file
          version:
            type: string
            default: "0.1"
  ExternalServiceConfig:
    properties:
      host:
        type: string
        default: localhost
      verify_certificate:
        type: string
        description: If the HTTPs certificates should be verified and the path of the certificate if a custom certificate is used.
        default: true
      timeout:
        type: number
